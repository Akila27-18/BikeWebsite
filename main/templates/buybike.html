{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="flex flex-col md:flex-row gap-6">

    <!-- Sidebar Filters -->
    <aside class="w-full md:w-1/4 bg-blue-100 p-4 rounded-lg shadow space-y-6">

        <h2 class="text-xl font-semibold border-b pb-2">Filter</h2>

        <form method="GET" class="space-y-6">

            <!-- Budget -->
            <div>
                <details open>
                    <summary class="font-medium cursor-pointer">Budget</summary>
                    <div class="mt-2 space-y-2">
                        <label><input type="radio" name="price_range" value="100000-200000"
                            {% if request.GET.price_range == "100000-200000" %}checked{% endif %}>
                            ₹100,000 - ₹200,000</label>
                        <label><input type="radio" name="price_range" value="200001-300000"
                            {% if request.GET.price_range == "200001-300000" %}checked{% endif %}>
                            ₹200,001 - ₹300,000</label>
                        <label><input type="radio" name="price_range" value="300001-400000"
                            {% if request.GET.price_range == "300001-400000" %}checked{% endif %}>
                            ₹300,001 - ₹400,000</label>
                    </div>
                </details>
            </div>

            <!-- Categories -->
            <div>
                <details>
                    <summary class="font-medium cursor-pointer">Categories</summary>
                    <select name="category" class="w-full mt-2 p-2 border rounded-md">
                        <option value="">All Categories</option>
                        <option value="Sports">Sports</option>
                        <option value="Cruiser">Cruiser</option>
                        <option value="Commuter">Commuter</option>
                    </select>
                </details>
            </div>

            <!-- Brand -->
            <div>
                <details open>
                    <summary class="font-medium cursor-pointer">Brand</summary>
                    <select name="brand" class="w-full mt-2 p-2 border rounded-md">
                        <option value="" {% if not request.GET.brand %}selected{% endif %}>All Brands</option>
                        <option value="Yamaha" {% if request.GET.brand == "Yamaha" %}selected{% endif %}>Yamaha</option>
                        <option value="Honda" {% if request.GET.brand == "Honda" %}selected{% endif %}>Honda</option>
                        <option value="Royal Enfield" {% if request.GET.brand == "Royal Enfield" %}selected{% endif %}>Royal Enfield</option>
                    </select>
                </details>
            </div>

            <!-- Year -->
            <div>
                <details open>
                    <summary class="font-medium cursor-pointer">Year</summary>
                    <select name="year" class="w-full mt-2 p-2 border rounded-md">
                        <option value="" {% if not request.GET.year %}selected{% endif %}>All Years</option>
                        <option value="2023" {% if request.GET.year == "2023" %}selected{% endif %}>2023</option>
                        <option value="2022" {% if request.GET.year == "2022" %}selected{% endif %}>2022</option>
                        <option value="2021" {% if request.GET.year == "2021" %}selected{% endif %}>2021</option>
                    </select>
                </details>
            </div>

            <!-- Kilometers -->
            <div>
                <details>
                    <summary class="font-medium cursor-pointer">Kilometers</summary>
                    <div class="mt-2 space-y-2">
                        <label><input type="radio" name="kilometers" value="0-10000"
                            {% if request.GET.kilometers == "0-10000" %}checked{% endif %}> Upto 10,000 km</label>
                        <label><input type="radio" name="kilometers" value="10001-30000"
                            {% if request.GET.kilometers == "10001-30000" %}checked{% endif %}> 10,001 - 30,000 km</label>
                        <label><input type="radio" name="kilometers" value="30001-60000"
                            {% if request.GET.kilometers == "30001-60000" %}checked{% endif %}> 30,001 - 60,000 km</label>
                    </div>
                </details>
            </div>

            <!-- Engine CC -->
            <div>
                <details>
                    <summary class="font-medium cursor-pointer">Engine CC</summary>
                    <div class="mt-2 space-y-2">
                        <label><input type="radio" name="engine_cc" value="100-200"
                            {% if request.GET.engine_cc == "100-200" %}checked{% endif %}> 100cc - 200cc</label>
                        <label><input type="radio" name="engine_cc" value="201-400"
                            {% if request.GET.engine_cc == "201-400" %}checked{% endif %}> 201cc - 400cc</label>
                        <label><input type="radio" name="engine_cc" value="401-800"
                            {% if request.GET.engine_cc == "401-800" %}checked{% endif %}> 401cc - 800cc</label>
                    </div>
                </details>
            </div>

            <!-- Fuel Type -->
            <div>
                <details>
                    <summary class="font-medium cursor-pointer">Fuel Type</summary>
                    <select name="fuel_type" class="w-full mt-2 p-2 border rounded-md">
                        <option value="">All</option>
                        <option value="Petrol" {% if request.GET.fuel_type == "Petrol" %}selected{% endif %}>Petrol</option>
                        <option value="Electric" {% if request.GET.fuel_type == "Electric" %}selected{% endif %}>Electric</option>
                    </select>
                </details>
            </div>

            <!-- Color -->
            <div>
                <details>
                    <summary class="font-medium cursor-pointer">Color</summary>
                    <select name="color" class="w-full mt-2 p-2 border rounded-md">
                        <option value="">All Colors</option>
                        <option value="Black" {% if request.GET.color == "Black" %}selected{% endif %}>Black</option>
                        <option value="Red" {% if request.GET.color == "Red" %}selected{% endif %}>Red</option>
                        <option value="Blue" {% if request.GET.color == "Blue" %}selected{% endif %}>Blue</option>
                        <option value="White" {% if request.GET.color == "White" %}selected{% endif %}>White</option>
                    </select>
                </details>
            </div>

            <!-- Buttons -->
            <div class="flex gap-2">
                <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded w-1/2">
                    Apply
                </button>
                <a href="{% url 'buy_bike' %}" class="bg-gray-400 text-white px-4 py-2 rounded w-1/2 text-center">
                    Clear
                </a>
            </div>
        </form>
    </aside>

    <!-- Main Content -->
    <main class="flex-1">
        <!-- Sort -->
        <div class="flex justify-end mb-4">
            <form method="GET" class="flex items-center space-x-4">
                <label for="sort_by" class="font-medium">Sort By:</label>
                <select name="sort_by" onchange="this.form.submit()" class="p-2 border rounded-md">
                    <option value="newest" {% if request.GET.sort_by == "newest" or not request.GET.sort_by %}selected{% endif %}>Newest First</option>
                    <option value="price_asc" {% if request.GET.sort_by == "price_asc" %}selected{% endif %}>Price: Low to High</option>
                    <option value="price_desc" {% if request.GET.sort_by == "price_desc" %}selected{% endif %}>Price: High to Low</option>
                </select>
            </form>
        </div>

        <!-- Bike Cards -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            {% for bike in bikes %}
                <a href="{% url 'bike_detail' bike.pk %}" class="block">
                    <div class="bg-white rounded-lg shadow-md p-4 relative">
                        {% if bike.status == 'booked' %}
                            <span class="bg-red-500 text-white px-2 py-1 text-xs rounded absolute top-2 left-2">Booked</span>
                        {% endif %}
                        <img src="{{ bike.image.url }}" alt="{{ bike.brand }} {{ bike.model }}" class="w-full h-48 object-cover rounded-md">
                        
                        <h3 class="text-lg font-semibold mt-4">
                            {{ bike.year }} | {{ bike.brand }} {{ bike.model }} | {{ bike.engine_cc }} CC
                        </h3>
                        
                        <p class="text-sm text-gray-600">
                            {{ bike.kilometers }} Km · {{ bike.fuel_type }} · {{ bike.owner }} Owner
                        </p>
                        
                        <p class="text-xl font-bold text-blue-600 mt-1">₹ {{ bike.price }}</p>
                        <p class="text-gray-500 text-sm">{{ bike.location }}</p>
                    </div>
                </a>
            {% empty %}
                <p class="text-center text-gray-600">No bikes found matching your criteria.</p>
            {% endfor %}
        </div>
    </main>
</div>
{% endblock %}
